import 'dart:convert';
import 'dart:typed_data';
import 'package:flutter/material.dart';
import 'package:fyn_zon/tokenPass.dart';
import 'mainApi.dart';

class Autogenerated {
  String message;
  String error;
  List<Data> data;

  Autogenerated({this.message, this.error, this.data});

  Autogenerated.fromJson(Map<String, dynamic> json) {
    message = json['message'];
    error = json['error'];
    if (json['data'] != null) {
      data = new List<Data>();
      json['data'].forEach((v) {
        data.add(new Data.fromJson(v));
      });
    }
  }

  Map<String, dynamic> toJson() {
    final Map<String, dynamic> data = new Map<String, dynamic>();
    data['message'] = this.message;
    data['error'] = this.error;
    if (this.data != null) {
      data['data'] = this.data.map((v) => v.toJson()).toList();
    }
    return data;
  }
}

class Data {
  String sId;
  String baseCurrency;
  String tradingCurrency;
  var price;
  var volume;
  String purpose;
  int time;

  Data(
      {this.sId,
      this.baseCurrency,
      this.tradingCurrency,
      this.price,
      this.volume,
      this.purpose,
      this.time});

  Data.fromJson(Map<String, dynamic> json) {
    sId = json['_id'];
    baseCurrency = json['baseCurrency'];
    tradingCurrency = json['tradingCurrency'];
    price = json['price'];
    volume = json['volume'];
    purpose = json['purpose'];
    time = json['time'];
  }

  Map<String, dynamic> toJson() {
    final Map<String, dynamic> data = new Map<String, dynamic>();
    data['_id'] = this.sId;
    data['baseCurrency'] = this.baseCurrency;
    data['tradingCurrency'] = this.tradingCurrency;
    data['price'] = this.price;
    data['volume'] = this.volume;
    data['purpose'] = this.purpose;
    data['time'] = this.time;
    return data;
  }
}

class AAAA extends StatefulWidget {
  @override
  _AAAAState createState() => _AAAAState();
}

class _AAAAState extends State<AAAA> {
  Autogenerated futureAlbum;
  fetchAlbum() async {
    /* var data = {

    };*/
    var apiData = {
      "url": AuthToken.api +
          "/" +
          "orderHistory/tradeHistory/?tradingCurrency=BTC",
      //"https://jsonplaceholder.typicode.com/albums/1",
      //"data": data
    };
    ApiClass.getApiCall(apiData, (onSuccess) {
      print(onSuccess.toString());
      futureAlbum = Autogenerated.fromJson(jsonDecode(onSuccess['response']));
      print("Dataget>>>>>>> " + futureAlbum.data.length.toString());
    }, (onError) {
      print("Error working with the api");
    });
  }

  @override
  void initState() {
    super.initState();
    fetchAlbum();
  }

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'Fetch Data Example',
      theme: ThemeData(
        primarySwatch: Colors.blue,
      ),
      home: Scaffold(
        appBar: AppBar(
          title: Text('Fetch Data Example'),
        ),
        body: Container(
          // child: Text(futureAlbum !=null?futureAlbum.tempSecret:""),
          child: ListView.builder(
            itemCount:
                futureAlbum.data.length == null ? 0 : futureAlbum.data.length,
            itemBuilder: (context, position) {
              return Card(
                child: ListTile(
                  leading: Image.network(
                    futureAlbum.data[position].baseCurrency,
                    fit: BoxFit.fill,
                    width: 100,
                    height: 500,
                    alignment: Alignment.center,
                  ),
                  title: Text(futureAlbum.data[position].tradingCurrency),
                  //title: Text(jsonDecode(data)['superheros'][index]['name']),
                  subtitle: Text(
                    futureAlbum.data[position].price.toString(),
                  ),
                ),
              );
            },
          ),
        ),
      ),
    );
  }
}
